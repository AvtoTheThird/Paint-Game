config:
  target: "http://localhost:3000"
  phases:
    - duration: 5
      arrivalRate: 80
  processor: "./processor.js"
  engines:
    socketio:
      transports: ["websocket"]

scenarios:
  - name: "Join room and simulate activity"
    flow:
      - function: "setRoomAndPosition"
      - log: "Room: {{ roomNumber }}, Position: {{ position }}"

      # Create room (only first user)
      - if:
          condition: "position === 0"
          then:
            - emit:
                event: "create_room"
                data:
                  name: "Test Room {{ roomNumber }}"
                  id: "room-{{ roomNumber }}"
                  maxPlayers: 8
                  time: 90
                  maxRounds: 8
            - think: 1

      # Join room
      - emit:
          event: "join_room"
          data:
            roomId: "room-{{ roomNumber }}"
            name: "User {{ $uuid }}"
            avatarID: 1
      - think: 2

      # Start game (first user)
      - if:
          condition: "position === 0"
          then:
            - emit:
                event: "startGame"
                data:
                  roomId: "room-{{ roomNumber }}"

      - think: 5

      # Drawing or chatting
      - if:
          condition: "position === 0"
          then:
            - loop:
                - emit:
                    event: "draw"
                    data:
                      roomId: "room-{{ roomNumber }}"
                      x0: "{{ $random.integer(0, 500) }}"
                      y0: "{{ $random.integer(0, 500) }}"
                      x1: "{{ $random.integer(0, 500) }}"
                      y1: "{{ $random.integer(0, 500) }}"
                      color: "#{{ $random.hex(6) }}"
                - think: 0.5
              count: 20
          else:
            - loop:
                - emit:
                    event: "message"
                    data:
                      roomId: "room-{{ roomNumber }}"
                      message: "Msg {{ $random.integer(1, 100) }}"
                      userName: "User {{ $uuid }}"
                - think: 1
              count: 10
